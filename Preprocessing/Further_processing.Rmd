---
title: "Normalization"
author: "Nils Eling"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 2
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, 
        encoding = encoding, output_file = '../../../Dropbox (Cambridge University)/Oesophagus_single_cell/Results/Reports/Normalization.html') })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Read in the data

```{r libraries, message=FALSE}
library(scran)
library(scater)
source("../Analysis/Functions/auxiliary.R")
```

Here, we compute tSNEs, perform clustering and detect marker genes

```{r data, eval=FALSE}
sce.list <- readRDS("../../../Dropbox (Cambridge University)/Oesophagus_single_cell/All_sce.rds")

for(i in 1:length(sce.list)){
  cur_sce <- sce.list[[i]]

  # tSNE
  if(!("TSNE" %in% reducedDimNames(cur_sce))){
    set.seed(1234)
    cur_sce <- runTSNE(cur_sce)
  }
  
  # Clustering
  if(!("Clusters" %in% names(colData(cur_sce)))){
    HVgenes <- HVG(cur_sce)
    cluster <- DTC(cur_sce, HVgenes)
    colData(cur_sce)$Clusters <- cluster
  }

  # Marker genes
  markers <- marker.detection(cur_sce, clusters = cluster)

}

saveRDS(sce.list, "../../../Dropbox (Cambridge University)/Oesophagus_single_cell/All_sce.rds")
```

